var common={$inputFile:".js-input-file",$inputTextFile:".js-input-txt-file",$uploadBlock:".js-upload-block",$uploadBtn:".js-upload-btn",$switchBtn:".js-switch-btn",initEvents:function(){var t=this;$(window).on({load:function(){$(t.$uploadBtn).on("click",$.proxy(t.opnUploadWindow,t)),$(t.$switchBtn).on("click",$.proxy(t.showCurrentBox,t)),$(".social__btn--like").on("click",$.proxy(t.showSocialBtns,t))}})},opnUploadWindow:function(t){var e=$(t.currentTarget);e.closest(this.$uploadBlock).find(this.$inputFile).click()},setFileName:function(t){var e=$(t.currentTarget);e.closest(this.$uploadBlock).find(this.$inputTextFile).val(e.val().split("\\").pop())},showCurrentBox:function(t){var e=$(t.currentTarget);e.addClass("btn--active").siblings().removeClass("btn--active").closest(".setting__position").find(".block--"+e.data("div")).addClass("active").siblings().removeClass("active"),t.preventDefault()},initRangeSlider:function(){},showSocialBtns:function(t){t.preventDefault(),$(t.currentTarget).closest(".socials").toggleClass("social--open")}},App={settings:{max_w:650,max_h:535},image:{width:650,height:535,el:$(".image")},watermark:{width:200,height:200,el:$(".watermark")},position:{top:0,left:0},opacity:100,type:"one",setImg:function(t,e){if("image"==t){this.image=e,this.image.el=$(".image"),this.image.el.css("background-image",e.url);var i=e.width,n=e.height;(e.width>this.settings.max_w||e.width>this.settings.max_w)&&console.log("смаштабируй!"),this.image.el.css("width",i),this.image.el.css("height",n)}else"watermark"==t&&(this.watermark=e,this.watermark.el=$(".watermark"),this.watermark.el.css("background-image",e.url),this.watermark.el.css("width",e.width),this.watermark.el.css("height",e.height))},setPos:function(t){(t.x||0===t.x)&&(this.position.left="number"==typeof t.x?t.x:this.getCoords("x",t.x)),(t.y||0===t.y)&&(this.position.top="number"==typeof t.y?t.y:this.getCoords("y",t.y)),this.watermark.el.css("left",this.position.left),this.watermark.el.css("top",this.position.top),$("#x").spinner("value",App.position.left),$("#y").spinner("value",App.position.top)},getCoords:function(t,e){var i=0;if("x"==t)switch(e){case"left":i=0;break;case"center":i=this.image.el.width()/2-this.watermark.el.width()/2;break;case"right":i=this.image.el.width()-this.watermark.el.width()}else if("y"==t)switch(e){case"top":i=0;break;case"middle":i=this.image.el.height()/2-this.watermark.el.height()/2;break;case"bottom":i=this.image.el.height()-this.watermark.el.height()}return i},clearForm:function(){$(".range-slider").slider("value",100),$("td").first().click()},submitForm:function(){var t={x:this.position.left,y:this.position.top,opacity:this.opacity};$.ajax({url:"/api/download",type:"GET",dataType:"json",data:t}).done(function(){console.log("success")}).fail(function(){console.log("error")})}};window.App=App,$.widget("ui.spinner",$.ui.spinner,{_buttonHtml:function(){var t='<div class="regulate__trigger trigger--arrow"><button data-step="x-up" type="button" class="btn--up ui-spinner-button ui-spinner-up">Больше</button><button data-step="x-down" type="button" class="btn--down ui-spinner-button ui-spinner-down">Меньше</button></div>';return t},_uiSpinnerHtml:function(){return"<div class='my-spinner ui-spinner ui-widget ui-widget-content'></div>"}}),$(document).ready(function(){common.initEvents(),$(document).on("keyup","#x",function(t){if(37!=t.keyCode&&39!=t.keyCode){var e=$(t.target),i=e.spinner("value");i<=e.spinner("option","max")&&i>=e.spinner("option","min")&&App.setPos({x:i})}}),$(document).on("keyup","#y",function(t){if(37!=t.keyCode&&39!=t.keyCode){var e=$(t.target),i=e.spinner("value");i<=e.spinner("option","max")&&i>=e.spinner("option","min")&&App.setPos({y:i})}}),$(".setting__buttons-reset").on("click",function(){App.clearForm()}),$(".setting__buttons-submit").on("click",function(t){t.preventDefault(),App.submitForm()}),$(".table__cell").on("click",function(t){$el=$(t.target),$(".table__cell").removeClass("cell--active"),$el.addClass("cell--active"),App.setPos({x:$el.data("x"),y:$el.data("y")})}),$("#original-image").fileupload({dataType:"json",url:"/_loftschool/dz-2.3/api-upload.json",done:function(t,e){status=e.jqXHR.status,200==status&&(resp=e.result,App.setImg("image",resp))},add:function(t,e){$("#original-image").siblings("input").val(e.files[0].name),e.submit()}}),$("#watermark").fileupload({dataType:"json",url:"/_loftschool/dz-2.3/api-upload.json",done:function(t,e){status=e.jqXHR.status,200==status&&(resp=e.result,App.setImg("watermark",resp))},add:function(t,e){$("#watermark").siblings("input").val(e.files[0].name),e.submit()}}),$(".watermark").draggable({containment:"parent",stop:function(t,e){App.setPos({x:e.position.left,y:e.position.top})}}),$(".range-slider").slider({range:"min",value:100,min:1,max:100,slide:function(t,e){App.opacity=e.value/100,$(".watermark").css("opacity",App.opacity)},change:function(t,e){App.opacity=e.value/100,$(".watermark").css("opacity",App.opacity)}}),$("#x").spinner({min:0,max:450,step:1,spin:function(t,e){App.setPos({x:e.value})},change:function(t){var e=$(t.target);App.setPos({x:e.spinner("value")})}}),$("#y").spinner({min:0,max:335,step:1,spin:function(t,e){App.setPos({y:e.value})},change:function(t){var e=$(t.target);App.setPos({y:e.spinner("value")})}})});